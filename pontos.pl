% -----------------------------------
% -----------------------------------
% -----------------------------------
% -----------------------------------
% -----------------------------------

%------PORTUGAL----------
%braga
posicao( p1, -84200, 415400 ).
%guimaraes
posicao( p2, -82900, 414400 ).
%porto
posicao( p3, -86200, 411600 ).
%lisboa
posicao( p4, -91400, 387200 ).
%faro
posicao( p5, -79300, 370200 ).
%guarda
posicao( p6, -72500, 405400 ).
%fatima
posicao( p7, -86500, 396200 ).
%viseu
posicao( p8, -79100, 406600 ).
%coimbra
posicao( p9, -84100, 402000 ).
%aveiro
posicao( p10, -86600, 406400 ).
%evora
posicao( p11, -79100, 385700 ).
%braganca
posicao( p12, -67600, 418000 ).
%madeira
posicao( p13, -169500, 327600 ).
%portosanto
posicao( p14, -163400, 330800 ).

%------resto europa--------

%madrid - espanha
posicao( p15, -37000, 404200 ).
%barcelona - espanha
posicao( p16, 21700, 413900 ).
%paris - franca
posicao( p17, 23500, 488600 ).
%monaco
posicao( p18, 74200, 437400 ).
%milao-italia
posicao( p19, 91800, 454600 ).
%roma-italia
posicao( p20, 124800, 418900 ).
%bruxelas - belgica
posicao( p21, 43500, 508500 ).
%londres - inglaterra
posicao( p22, -1200, 515100 ).
%berlim - alemanha
posicao( p23, 134100, 525200 ).
%ibiza - espanha
posicao( p24, 14200, 389100 ).
%palma - espanha
posicao( p25, 26500, 395700 ).
%cagliari - italia
posicao( p26, 91400, 392500 ).
%moscovo - russia
posicao( p27, 376100, 557500 ).
%minsk - bielorussia
posicao( p28, 275600, 539000 ).
%cracovia - polonia
posicao( p29, 199500, 500600 ).
%helsinquia - finlandia
posicao( p30, 249400, 601700 ).
%pello - finlandia
posicao( p31, 239600, 667700 ).
%estocolmo - suecia
posicao( p32, 180600, 593300 ).
%oslo - noruega
posicao( p33, 107500, 599200 ).
%s.petersburgo - russia
posicao( p34, 303200, 599300 ).



%braga
propriedade( p1, local, 'Braga' ).
propriedade( p1, empresa, 'Banana Corp' ).
propriedade( p1, servico, 'Turismo' ).
propriedade( p1, shopping, bragaparque ).
propriedade( p1, farmacia, 'Almiro' ).
propriedade( p1, restauracao, 'McDonalds' ).
propriedade( p1, cinema, 'Golden Center' ).
propriedade( p1, aerodromo, 'Aerodromo de Palmeira' ).
propriedade( p1, museu, 'Museu dos Biscainhos' ).
propriedade( p1, hospital, 'Sao Marcos' ).
propriedade( p1, clinica, 'Sta Tecla' ).
propriedade( p1, monumento, 'Bom Jesus' ).
propriedade( p1, estadio, 'Estadio Axa' ).
propriedade( p1, transportes, 'TUB' ).
propriedade( p1, universidade, 'Universidade do Minho' ).


%guimaraes
propriedade( p2, local, 'Guimaraes' ).
propriedade( p2, universidade, 'Universidade do Minho' ).
propriedade( p2, monumento, 'Castelo' ).
propriedade( p2, estacao, 'CP' ).
propriedade( p2, empresa, 'McDonalds' ).
propriedade( p2, hospital,'Sra da Oliveira' ).
propriedade( p2, hotel, 'Hotel Guimaraes' ).
propriedade( p2, estadio, 'D. Afonso Henriques' ).
propriedade( p2, empresa, 'Fraterna' ).


%porto
propriedade( p3, local, 'Porto' ).
propriedade( p3, estadio, 'Estadio do Bessa' ).
propriedade( p3, monumento, 'Clerigos' ).
propriedade( p3, shopping, 'Norte Shopping' ).
propriedade( p3, lazer, 'Via Norte' ).
propriedade( p3, aeroporto, 'Sa Carneiro' ).
propriedade( p3, restauracao, 'Papaki' ).
propriedade( p3, turismo, 'Rota dos vinhos' ).
propriedade( p3, pastelaria, 'Petulia' ).
propriedade( p3, empresa, 'Sonae' ).
propriedade( p3, transportes, 'Carris' ).


%lisboa
propriedade( p4, local, 'Lisboa' ).
propriedade( p4, estadio, 'Lisboa' ).
propriedade( p4, estadio, 'Estadio Nacional' ).
propriedade( p4, catedral, 'Sta Maria').
propriedade( p4, monumento, 'Padrao dos descobrimentos').
propriedade( p4, pavilhao, 'MEO Arena' ).
propriedade( p4, aeroporto, 'Aeroporto Internacional' ).
propriedade( p4, restauracao, 'Pizza Hut' ).
propriedade( p4, transportes, 'Transtejo' ).
propriedade( p4, empresa, 'Google Portugal' ).
propriedade( p4, universidade, 'Nova de Lisboa' ).


%faro
propriedade( p5, local, 'Faro' ).
propriedade( p5, aeroporto, 'Aeroporto de Faro' ).
propriedade( p5, lazer, 'Aquashow' ).
propriedade( p5, marina, 'Marina de Vilamoura' ).
propriedade( p5, estacao, 'Ferroviaria de Faro' ).
propriedade( p5, monumento, 'Ruinas de milreu' ).
propriedade( p5, igreja, 'Carmo' ).
propriedade( p5, shopping, 'Forum Algarve' ).
propriedade( p5, praia, 'Falesia' ).


%guarda
propriedade( p6, local, 'Guarda' ).
propriedade( p6, lazer, 'Serra da Estrela' ).
propriedade( p6, universidade, 'Universidade da Covilha' ).
propriedade( p6, hotel, 'Estrela Hotel' ).


%fatima
propriedade( p7, local, 'Fatima')
propriedade( p7, santuario, 'Santuario de Fatima' ).
propriedade( p7, grutas, 'Grutas de mira d aire' ).


%viseu
propriedade( p8, local, 'Viseu' ).
propriedade( p8, monumento, 'Se de Viseu' ).
propriedade( p8, shopping, 'Palacio do Gelo' ).
propriedade( p8, hospital, 'Sao Teotonio' ).
propriedade( p8, farmacia, 'Tomas Ribeiro' ).
propriedade( p8, pastelaria, 'Croassaint de ouro' ).
propriedade( p8, desporto, 'Fontelo' ).
propriedade( p8, politecnico, 'Politecnico de Viseu' ).


%coimbra
propriedade( p9, local, 'Coimbra' ).
propriedade( p9, universidade, 'Universidade de Coimbra' ).
propriedade( p9, monumento, 'Quinta das Lagrimas' ).
propriedade( p9, estadio, 'Estadio Cidade de Coimbra' ).
propriedade( p9, lazer, 'Portugal dos pequenitos' ).
propriedade( p9, convento, 'Santa Clara A Nova' ).
propriedade( p9, palacio , 'Bussaco' ).


%aveiro
propriedade( p10, local, 'Aveiro' ).
propriedade( p10, universidade, 'Universidade de Aveiro' ).
propriedade( p10, lazer, 'Ria de Aveiro' ).
propriedade( p10, estadio, 'Estadio Municipal de Aveiro' ).
propriedade( p10, pastelaria, 'Ria Pao' ).
propriedade( p10, igreja, 'Nossa Sra da Nazare' ).
propriedade( p10, monumento , 'Forte da Barra' ).
propriedade( p10, shopping , 'Forum Aveiro' ).
propriedade( p10, praia , 'Praia da Barra' ).


%evora
propriedade( p11, local, 'Evora' ).
propriedade( p11, universidade, 'Universidade de Evora' ).
propriedade( p11, catedral, 'Se Catedral' ).
propriedade( p11, museu, 'Museu de Evora' ).
propriedade( p11, capela, 'Capela dos Ossos' ).
propriedade( p11, monumento, 'Templo Romano' ).


%braganca
propriedade( p12, local, 'Braganca' ).
propriedade( p12, aerodromo, 'Aerodromo de Braganca' ).
propriedade( p12, monumento, 'Castelo de Braganca' ).
propriedade( p12, politecnico, 'Politecnico de Braganca' ).


%madeira
propriedade( p13, local, 'Madeira' ).
propriedade( p13, marina, 'Marina do Funchal' ).
propriedade( p13, hotel, 'Ocean Gardens' ).
propriedade( p13, praia, 'Ponta do Sol' ).
propriedade( p13, aeroporto, 'Aeroporto internacional' ).
propriedade( p13, monumento, 'Forte de S Joao Batista' ).
propriedade( p13, parque, 'Parque Ribeiro Frio' ).


%porto_santo
propriedade( p14, local, 'Porto Santo' ).
propriedade( p14, residencial, 'Residencial Theresia' ).
propriedade( p14, praia, 'Praia Dourada' ).
propriedade( p14, aeroporto, 'Aeroporto Porto Santo' ).
propriedade( p14, lazer, 'Porto Santo Golf' ).
propriedade( p14, monumento, 'Vila Baleira' ).


%madrid
propriedade( p15, local, 'Madrid' ).
%barcelona
propriedade( p16, local, 'Barcelona' ).
%paris
propriedade( p17, local, 'Paris' ).
%monaco
propriedade( p18, local, 'Monaco' ).
%milao
propriedade( p19, local, 'Milao' ).
%roma
propriedade( p20, local, 'Roma' ).
%bruxelas
propriedade( p21, local, 'Bruxelas' ).
%londres
propriedade( p22, local, 'Londres' ).
%berlim
propriedade( p23, local, 'Berlim' ).
%ibiza
propriedade( p24, local, 'Ibiza' ).
%palma
propriedade( p25, local, 'Palma' ).
%cagliari
propriedade( p26, local, 'Cagliari' ).
%moscovo
propriedade( p27, local, 'Moscovo' ).
%minsk
propriedade( p28, local, 'Minsk' ).
%cracovia
propriedade( p29, local, 'Cracovia' ).
%helsinquia
propriedade( p30, local, 'Helsinquia' ).
%pello
propriedade( p31, local, 'Pello' ).
%estocolmo
propriedade( p32, local, 'Estocolmo' ).
%oslo
propriedade( p33, local, 'Oslo' ).
%spetersburgo
propriedade( p34, local, 'S Petersburgo' ).



% -----------------------------------
% -----------------------------------
% -----------------------------------
% -----------------------------------
% -----------------------------------
% -----------------------------------
% -----------------------------------
% -----------------------------------
% define ligações entre pontos
% arco( Ponto1, Ponto2 )
%braga<->guimares
arco(p1,p2).
arco(p2,p1).
%guimares<->porto
arco(p2,p3).
arco(p3,p2).
%porto<->lisboa
arco(p3,p4).
arco(p4,p3).
%lisboa<->faro
arco(p4,p5).
arco(p5,p4).
%lisboa<->guarda
arco(p4,p6).
arco(p6,p4).
%lisboa<->fatima
arco(p4,p7).
arco(p7,p4).
%coimbra<->fatima
arco(p9,p7).
arco(p7,p9).
%lisboa<->viseu
arco(p4,p8).
arco(p8,p4).
%porto<->viseu
arco(p3,p8).
arco(p8,p3).
%viseu<->guarda
arco(p8,p6).
arco(p6,p8).
%lisboa->coimbra
arco(p4,p9).
arco(p9,p4).
%porto->coimbra
arco(p3,p9).
arco(p9,p3).
%porto->aveiro
arco(p3,p10).
arco(p10,p3).
%aveiro->coimbra
arco(p10,p9).
arco(p9,p10).
%guarda->evora
arco(p6,p11).
arco(p11,p6).
%viseu->evora
arco(p8,p11).
arco(p11,p8).
%braga->braganca
arco(p1,p12).
arco(p12,p1).
%guimaraes->braganca
arco(p2,p12).
arco(p12,p2).
%guarda->madrid
arco(p6,p15).
arco(p15,p6).
%braganca->madrid
arco(p12,p15).
arco(p15,p12).
%madrid->barcelona
arco(p15,p16).
arco(p16,p15).
%barcelona->paris
arco(p16,p17).
arco(p17,p16).
%barcelona->monaco
arco(p16,p18).
arco(p18,p16).
%monaco->milao
arco(p18,p19).
arco(p19,p18).
%milao->roma
arco(p19,p20).
arco(p20,p19).
%paris->bruxelas
arco(p17,p21).
arco(p21,p17).
%bruxelas->berlim
arco(p21,p23).
arco(p23,p21).
%bruxelas->londres
arco(p21,p22).
arco(p22,p21).
%paris->berlim
arco(p17,p23).
arco(p23,p17).
%moscovo->minsk
arco(p28,p27).
arco(p27,p28).
%cracovia->minsk
arco(p29,p28).
arco(p28,p29).
%berlim->moscovo
arco(p23,p28).
arco(p28,p23).
%berlim->cracovia
arco(p23,p29).
arco(p29,p23).
%milao->cracovia
arco(p19,p29).
arco(p29,p19).
%moscovo->spetersburgo
arco(p27,p34).
arco(p34,p27).
%pello->estocolmo
arco(p31,p32).
arco(p32,p31).
%pello->oslo
arco(p31,p33).
arco(p33,p31).
%estocolmo->oslo
arco(p32,p33).
arco(p33,p32).
%spetersburgo->helsinquia
arco(p34,p30).
arco(p30,p34).
%helsinquia->pello
arco(p30,p31).
arco(p31,p30).

% -----------------------------------
% predicado distancias entre s pontos
% distancia(lojaA, lojaB, Resultado).

distancia(A,B,R) :-
	posicao(A,X1,Y1),
	posicao(B,X2,Y2),
	distancia(X1,Y1,X2,Y2,R).

% -----------------------------------
% predicado distancias entre pontos

distancia(X1, Y1, X2, Y2, R) :-
	R is sqrt( exp(X1 - X2,2) + exp(Y1 - Y2,2) ).

% -----------------------------------
% predicado ponto de interesse próximo
% pontoProximo( X, Y, distanciaMax, Ponto ).

pontoProximo( X, Y, 0, P ) :-
	posicao(P, X, Y).
pontoProximo( X, Y, M, P ) :-
	posicao(P, A, B),
	distancia( X, Y, A, B, N ),
	N =< M.

%findall(A,arco(O,A),[X|Y])

caminho(O,D,_,0):-O==D.
caminho(O,D,_,V):-arco(O,D), distancia(O,D,V).
caminho(O,D,[H|T],A+V):- distancia(O,H,X), findall(L,arco(H,L),Bag),Bag\==[],caminho(H,D,Bag,Y),A is (X+Y).%; caminho(O,D,T,V).
caminho(O,D,[],1000000).

caminhos(O,D,Bag):-findall(X,arco(O,X),L),findall(V,caminho(O,D,L,V),Bag).

contidoNaArea(CX1,CY1,CX2,CY2,Bag):- findall(N,(posicao(N,X,Y),X>=CX1,X=<CX2,Y>=CY1,Y=<CY2),Bag).

acessiveis(O,D):-arco(O,D),!.
acessiveis(O,D):-arco(O,X),acessiveis(X,D).

caminhosPossiveis(O,D,L):-travessia(O,D,[O],L).


%ESTA RESOLVE!
caminhos2(A,B,Lc):-setof(Cam,(caminhosPossiveis(A,B,Cam),member(A,Cam),member(B,Cam)),Lc),!.
caminhos2(_,_,[]).

custoCaminho([X],0).
custoCaminho([H,Y|T],C):-distancia(H,Y,X),custoCaminho([Y|T],Z), C is X+Z.

travessia(O,D,Vis,[D|Vis]):- arco(O,D).
travessia(O,D,Vis,L):- arco(O,X),X\==D,\+ member(X,Vis),travessia(X,B,[X|Vis],L). 

melhorCaminho(O,D,M):- caminhos2(O,D,Lc), transformaCamsEmVals(Lc,Vals), minLista(Vals,M).

transformaCamsEmVals([],[]).
transformaCamsEmVals([A|As],[H|T]):-custoCaminho(A,H),transformaCamsEmVals(As,T).

reverse([],Z,Z).
reverse([H|T],Z,Acc) :- reverse(T,Z,[H|Acc]).

min(X,Y,X):- X<Y.
min(X,Y,Y):- X>=Y. 

minLista([H],H).
minLista([H|T],X):- minLista(T,M), X is min(H,M).

% encontrar todos os arcos

todosArcos(Bag):-findall((X,Y),arco(X,Y),Bag).
 
 
coordenadasPontos((X,Y),X1,Y1,X2,Y2):- posicao(X,X1,Y1),posicao(Y,X2,Y2).
 
todosPontosArcos([],[]).
todosPontosArcos([H|T],[(X1,Y1,X2,Y2)|P]):- coordenadasPontos(H,X1,Y1,X2,Y2),todosPontosArcos(T,P).
 
predicadoTotalArcos(L):-todosArcos(Bag),todosPontosArcos(Bag,L).

% encontrar todos os pontos do melhor caminho

melhorPercursoPontos(O,D,C2):-
	caminhos2(O,D,Lc),
	transformaCamsEmVals(Lc,Vals),
	minLista(Vals,Min),
	obtemCaminhoPeloValor(Min, Vals, Lc, C),
	reverse(C,C2,[]).

% valor_alvo, listaValores, listaCaminhos, caminho_resultado
obtemCaminhoPeloValor(Vt,[Vt|Lv],[Ct|Lc],Ct).
obtemCaminhoPeloValor(Vt,[Va|Lv],[Ca|Lc],Ct) :-
	obtemCaminhoPeloValor(Vt,Lv,Lc,Ct).

% encontrar todos os custos do melhor caminho

melhorPercursoDistancias(O,D,V2) :-
	melhorPercursoPontos(O,D,C),
	custosCaminho(C,V),
	reverse(V,V2,[]).

custosCaminho([X],[]).
custosCaminho([O,D|Resto],[Resultado|Next]):-
	distancia(O,D,Resultado),
	custosCaminho([D|Resto],Next).
